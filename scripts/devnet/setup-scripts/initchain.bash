#!/bin/bash
# Initializes the Regen node and generates a new genesis file.

set -uxe

# Set base path and environment variables
BASE_PATH=${BASE_PATH:-/mnt/nvme}
export HOME_DIR=${BASE_PATH}/.regen

# Check for or set default moniker
MONIKER=$1
if [ -z "$MONIKER" ]; then
    MONIKER="test-sync"
fi

# Ensure the home directory exists
if [ ! -d "$HOME_DIR" ]; then
    mkdir -p "$HOME_DIR"
fi

# Initialize the node with the provided or default moniker and generate a new genesis file
regen init "$MONIKER" --home "$HOME_DIR"

# Genesis file has already been generated by 'regen init'
GENESIS_FILE="$HOME_DIR/config/genesis.json"

if [ -f "$GENESIS_FILE" ]; then
    echo "New genesis file created at: $GENESIS_FILE"
else
    echo "Error: Genesis file not found!"
    exit 1
fi
